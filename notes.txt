import { useCallback, useEffect, useState } from "react";
import Head from "next/head";
import Image from "next/image";
import { useMenu } from "../Context/MenuContext";
import menu from "../data/menu";

const AdminPage = () => {
  const { addToMenu, menuItems, setMenuItems } = useMenu();

  const [currentPage, setCurrentPage] = useState(1);
  const imagesToShow = menu.items;

  const handleAddToMenu = useCallback(
    (index) => {
      const currentItem = imagesToShow[index];
      const itemInMenuIndex = menuItems.findIndex(
        (menuItem) =>
          menuItem.id === currentItem.id && menuItem.origin === "/AdminPage"
      );

      if (itemInMenuIndex !== -1) {
        // If the item is already in the menu, remove it
        const updatedMenu = menuItems.filter(
          (_, idx) => idx !== itemInMenuIndex
        );
        // Update the menu state
        setMenuItems(updatedMenu);
      } else {
        // If the item is not in the menu, add it
        addToMenu({
          id: currentItem.id,
          image: currentItem.imagen,
          price: currentItem.precio,
          name: currentItem.nombre,
          descrip: currentItem.descripcion,
          origin: "/AdminPage",
        });
      }
    },
    [addToMenu, menuItems, imagesToShow, setMenuItems]
  );

  return (
    <>
      <Head>
        <title>AdminPage</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
      </Head>
      <section>
        {imagesToShow.map((item, index) => (
          <section key={index}>
            <Image
              src={item.imagen}
              alt={`Imagen ${index + 1}`}
              width={200}
              height={200}
            />
            <div>
              <button onClick={() => handleAddToMenu(index)}>
                {item.addedToMenu
                  ? "Remover del Menu"
                  : "Agregar al Menu"}
              </button>
              <h3>
                <b>Precio:</b> {item.precio} $
              </h3>
            </div>
            <p>{item.descripcion}</p>
          </section>
        ))}
      </section>
    </>
  );
};

export default AdminPage;
///////////////////
import React, { createContext, useContext, useState, useEffect } from 'react';

const MenuContext = createContext();

export const useMenu = () => {
  const context = useContext(MenuContext);
  if (!context) {
    throw new Error("useMenu must be used within a MenuProvider");
  }
  return context;
};

export const MenuProvider = ({ children }) => {
  const [menuItems, setMenuItems] = useState([]);

  useEffect(() => {
    // Retrieve menu items from localStorage on page load
    const storedMenuItems = localStorage.getItem('menuItems');
    if (storedMenuItems) {
      setMenuItems(JSON.parse(storedMenuItems));
    }
  }, []);

  const addToMenu = (item) => {
    const existingItemIndex = menuItems.findIndex(
      (menuItem) => menuItem.id === item.id && menuItem.origin === item.origin
    );

    if (existingItemIndex !== -1) {
      const updatedMenu = [...menuItems];
      updatedMenu[existingItemIndex].quantity += item.quantity;
      setMenuItems(updatedMenu);
      localStorage.setItem('menuItems', JSON.stringify(updatedMenu));
    } else {
      const updatedMenu = [...menuItems, item];
      setMenuItems(updatedMenu);
      localStorage.setItem('menuItems', JSON.stringify(updatedMenu));
    }
  };

  const menuCount = menuItems.length;

  return (
    <MenuContext.Provider value={{ menuItems, setMenuItems, addToMenu, menuCount }}>
      {children}
    </MenuContext.Provider>
  );
};
//////////////en mi pagina de adminpage el botn de agregar al menu agrega pero el de remover del menu no funciona no puedo removerlo del emnu despeus de agregarlo sera por que es un solo boton para las dos cosas como podria resolverlo
